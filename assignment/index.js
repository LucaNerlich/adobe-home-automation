"use strict";(()=>{var Y="provider",W="provider-form",X="consumer",K="consumer-form";function c(){let r=()=>Math.floor((1+Math.random())*65536).toString(16).substring(1);return r()+"-"+r()+"-"+r()+"-"+r()+"-"+r()}function H(){return document.getElementById(X)}function N(){return document.getElementById(Y)}function I(r,e,t){return new CustomEvent(r,{detail:{id:e,value:t}})}function h(r){return r?.replaceAll(" ","-").toLowerCase()}function x(r,e){let t=document.createElement("form");return t.classList.add(`${e}-form`),t.id=r,t}function oe(r,e){return{type:"data-"+r,value:e}}function E(r){return oe("form-element",r)}function g(r,e){r.setAttribute(e.type,e.value)}function F(){return document.querySelector('#consumer-form > select[data-form-element="consumer-topic-select"]')}function T(r,e){function t(){document.getElementById(r)?.remove(),e&&e()}let n=document.createElement("button");return n.textContent="X",n.addEventListener("click",t),n.classList.add("delete"),g(n,E("delete-"+r)),n}var P=class{};var R=new Map,f=new Map,d=()=>{function r(i,m){m&&(R.has(i)?R.get(i)?.push(m):R.set(i,[m]))}function e(i){R.has(i)&&R.delete(i)}function t(i){return R.get(i)}function n(i,m){if(f.has(i)){let l=f.get(i);f.set(i,l?l+1:1)}else f.set(i,1),m&&m()}function o(i){if(f.has(i)){let l=f.get(i)??0,A=l>1?l-1:0;if(f.set(i,A),A===0){console.warn('Deleted last provider of topic: "%s".',i);let _=F();Array.from(_?.options).forEach(v=>{v.value===i&&v.remove()})}}return!1}function s(i){return f.get(i)??0}function a(){return f}return{addConsumer:r,removeConsumer:e,getConsumer:t,addTopic:n,removeTopic:o,getTopicCount:s,getAllTopics:a}};var p=class r extends P{id;label;topic;strategy;registryService=d();constructor(e,t,n){super(),this.id=c(),this.topic=h(e),this.label=t,this.strategy=n}static getConsumerWrapper(e,t){let n=document.createElement("div");return n.id=e,n.classList.add("consumer-item"),t&&t.length>0&&n.setAttribute("data-label",t),n}getElement(){let e=r.getConsumerWrapper(this.id,this.getLabel());e.classList.add(`consumer-item-${this.strategy.strategyType}`),e.textContent=this.getLabel()+": ",e.appendChild(this.getDisplayElement());let t=document.createElement("p");return t.textContent=this.topic,e.appendChild(T(this.id,()=>{this.registryService.removeConsumer(this.topic)})),e.appendChild(t),e}getDisplayElement(){return this.strategy.createConsumerElement(this.topic,{label:this.label,id:this.id,value:!1})}getLabel(){return this.label?this.label:"simple-consumer"}};var C=class{};var L=(n=>(n.BOOLEAN_STRATEGY="BOOLEAN_STRATEGY",n.NUMBER_STRATEGY="NUMBER_STRATEGY",n.TEXT_STRATEGY="TEXT_STRATEGY",n))(L||{});var b=class extends C{strategyType="NUMBER_STRATEGY";registryService=d();dispatchEvent(e,...t){let n=t[0],o=t[1],s=e.target,a=I(n,o,s?.valueAsNumber);this.registryService.getConsumer(n)?.forEach(m=>{m.dispatchEvent(a)})}createProviderElement(e,t){let n=c(),o=x(n,"number-strategy"),s=c(),a=M(s,t||e,"provider-item-label_"+e);o.appendChild(a);let i=D(s,"provider-item-input_"+e,"number");return i.setAttribute("name",t||e),i.setAttribute("min","0"),i.setAttribute("max","1"),i.setAttribute("step","0.1"),i.setAttribute("placeholder","% max. value"),i.addEventListener("change",m=>this.dispatchEvent(m,e,s)),o.appendChild(i),o.appendChild(T(n,()=>{this.registryService.removeTopic(e)})),o}createConsumerElement(e,t){let n=document.createElement("span"),o=parseFloat(t.value);return isNaN(o)?n.textContent="N/A":n.textContent=o.toString(),n.addEventListener(e,this.update),this.registryService.addConsumer(e,n),n}update(e){let t=e.detail,n=this;n&&(n.textContent=t.value)}};var y=class extends C{strategyType="TEXT_STRATEGY";registryService=d();createConsumerElement(e,t){let n=document.createElement("span");return n.textContent=t.value,n.style.color="blue",n.addEventListener(e,this.update),this.registryService.addConsumer(e,n),n}createProviderElement(e,t){let n=c(),o=x(n,"text-strategy"),s=c(),a=M(s,t||e,"provider-item-label_"+e);o.appendChild(a);let i=D(s,"provider-item-input_"+e,"text");return i.setAttribute("name",t||e),i.setAttribute("placeholder","some led display"),i.addEventListener("input",m=>this.dispatchEvent(m,e,s)),o.appendChild(i),o.appendChild(T(n,()=>{this.registryService.removeTopic(e)})),o}dispatchEvent(e,...t){let n=t[0],o=t[1],s=e.target,a=I(n,o,s?.value);this.registryService.getConsumer(n)?.forEach(m=>{m.dispatchEvent(a)})}update(e){let t=e.detail,n=this;n&&(n.textContent=t.value)}};function se(r,e){let t=document.createElement("div");if(e!=null)switch(e){case"BOOLEAN_STRATEGY":t=new u().createProviderElement(r);break;case"NUMBER_STRATEGY":t=new b().createProviderElement(r);break;case"TEXT_STRATEGY":t=new y().createProviderElement(r);break;default:console.error("Cannot create provider for non existent strategy: ",e);break}return t}function ae(r,e,t){let n=null;if(t!=null)switch(t){case"BOOLEAN_STRATEGY":n=new p(r,e,new u);break;case"NUMBER_STRATEGY":n=new p(r,e,new b);break;case"TEXT_STRATEGY":n=new p(r,e,new y);break;default:console.error("Cannot create consumer for non existent strategy: ",t);break}return n}function B(r,e){let t="",n="",o=null;if(r.forEach((s,a)=>{a===O?t=h(s.toString()):a===k?o=s:a===w&&(n=s)}),t&&t.length>0&&o){let s=ae(t,n,o)?.getElement();switch(e){case"PROVIDER":N()?.appendChild(se(t,o));break;case"CONSUMER":s&&H()?.appendChild(s);break;default:console.error("No device implementation exists for given type: ",e);break}}}var O="topic",w="name",k="strategies";function j(r){let e=document.createElement("input");return g(e,E("submit_"+h(r))),e.setAttribute("type","submit"),e.setAttribute("value",r),e}function S(r){let e=document.createElement("option");return g(e,E("select-option_"+h(r))),e.setAttribute("value",r),e.textContent=r.replace("_STRATEGY",""),e}function q(r){r.appendChild(document.createElement("br"));let e=c(),t=document.createElement("label");g(t,E("strategy-select-label")),t.setAttribute("for",e),t.textContent="Use Case",r.appendChild(t);let n=document.createElement("select");g(n,E("strategy-select")),n.id=e,n.setAttribute("name",k),Object.keys(L).filter(o=>isNaN(Number(o))).forEach(o=>{n.appendChild(S(o))}),r.appendChild(n)}function me(r){let e=d();r.appendChild(document.createElement("br"));let t=c(),n=document.createElement("label");g(n,E("consumer-topic-label")),n.setAttribute("for",t),n.textContent="Available Topics",r.appendChild(n);let o=document.createElement("select");g(o,E("consumer-topic-select")),o.id=t,o.setAttribute("name",O),e.getAllTopics().forEach((s,a)=>{o.appendChild(S(a))}),r.appendChild(o)}function $(r){let e=c(),t=document.createElement("span");return t.setAttribute("role","error"),t.id=e,t.style.display="none",t.style.color="red",t.textContent=r,t}function z(r){let e=d();if(r){let t=J("Topic","provider-topic",O);r.appendChild(t[0]),r.appendChild(t[1]),q(r);let n=j("Add Provider"),o=$("Invalid: Duplicate Topic");r.appendChild(n),r.appendChild(o),r.addEventListener("submit",s=>{s.preventDefault();let a=s.target,i=new FormData(a),m=!0,l="";i.forEach((A,_)=>{_===O&&(l=h(A.toString()),e.addTopic(l,()=>{F()?.appendChild(S(l))}),m=!0)}),m&&(o.style.display="none",a.reset(),B(i,"PROVIDER"))})}}function M(r,e,t){let n=document.createElement("label");return n.setAttribute("for",r),g(n,E((t||e)+"-label")),n.textContent=e,n}function D(r,e,t){let n=document.createElement("input");return n.id=r,g(n,E(e+"-input")),n.setAttribute("type",t),n}function J(r,e,t){let n=c(),o=M(n,r,e),s=D(n,e,"text");return s.setAttribute("name",t),s.setAttribute("placeholder",r),s.setAttribute("required","true"),[o,s]}function Q(r){if(r){r.innerHTML="";let e=J("Name","consumer-name",w);r.appendChild(e[0]),r.appendChild(e[1]),me(r),q(r);let t=j("Add Consumer");r.appendChild(t);let n=$("Invalid: Name cannot be empty.");r.appendChild(n),r.addEventListener("submit",o=>{o.preventDefault();let s=o.target,a=new FormData(s),i=!0;a.forEach((m,l)=>{l===w&&(m.toString().trim().length===0?(n.style.display="",i=!1):i=!0)}),i&&(n.style.display="none",s.reset(),B(a,"CONSUMER"))})}}var G="bool-strategy-off",V="bool-strategy-on",u=class r extends C{strategyType="BOOLEAN_STRATEGY";registryService=d();static parseValue(e){return e.value>0||e.value<0||e.value==="true"||e.value===!0}static setValue(e,t){e?(t.textContent="ON",t.classList.contains(G)&&t.classList.remove(G),t.classList.add(V)):(t.textContent="OFF",t.classList.contains(V)&&t.classList.remove(V),t.classList.add(G))}dispatchEvent(e,...t){let n=t[0],o=t[1],s=e.target,a=I(n,o,s?.checked);this.registryService.getConsumer(n)?.forEach(m=>{m.dispatchEvent(a)})}createProviderElement(e,t){let n=c(),o=x(n,"bool-strategy"),s=c(),a=M(s,t||e,"provider-item-label_"+e);o.appendChild(a);let i=D(s,"provider-item-input_"+e,"checkbox");return i.setAttribute("name",t||e),i.addEventListener("change",m=>this.dispatchEvent(m,e,s)),o.appendChild(i),o.appendChild(T(n,()=>{this.registryService.removeTopic(e)})),o}createConsumerElement(e,t){let n=r.parseValue(t),o=document.createElement("span");return r.setValue(n,o),o.addEventListener(e,this.update),this.registryService.addConsumer(e,o),o}update(e){let t=e.detail,n=this;n&&r.setValue(r.parseValue(t),n)}};document.getElementById("load-demo-button")?.addEventListener("click",r=>{let e="light-1",t="light-2",n="heating-1",o="text-1",s=d(),a=document.querySelector('#consumer-form > select[data-form-element="consumer-topic-select"]');a?.appendChild(S(e)),a?.appendChild(S(t)),a?.appendChild(S(n)),a?.appendChild(S(o));let i=N(),m=new u().createProviderElement(e);i?.appendChild(m),s.addTopic(e);let l=new u().createProviderElement(t);i?.appendChild(l),s.addTopic(t);let A=new b().createProviderElement(n);i?.appendChild(A),s.addTopic(n);let _=new y().createProviderElement(o);i?.appendChild(_),s.addTopic(o);let v=H(),Z=new p(e,"Kitchen - Light (Left)",new u);v?.appendChild(Z.getElement());let ee=new p(e,"Kitchen - Light (Right)",new u);v?.appendChild(ee.getElement());let te=new p(t,"Living Room - Light (All)",new u);v?.appendChild(te.getElement());let ne=new p(n,"Living Room - (Heating)",new b);v?.appendChild(ne.getElement());let re=new p(o,"LED Display - (Wall)",new y);v?.appendChild(re.getElement());let U=r.target;U.disabled=!0,U.style.display="none"});document.getElementById("load-demo-button")?.click();z(document.getElementById(W));Q(document.getElementById(K));})();
