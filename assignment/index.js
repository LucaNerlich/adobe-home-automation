(()=>{var b=new Map;function y(n,r){var t;r&&(b.has(n)?(t=b.get(n))==null||t.push(r):b.set(n,[r]))}var g=[],U="provider",V="provider-form",k="consumer",G="consumer-form";function d(){let n=()=>Math.floor((1+Math.random())*65536).toString(16).substring(1);return n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()}function D(){return document.getElementById(k)}function O(){return document.getElementById(U)}function S(n,r,t){return new CustomEvent(n,{detail:{id:r,value:t}})}function h(n){return n==null?void 0:n.replaceAll(" ","-").toLowerCase()}function tt(n,r){return{type:"data-"+n,value:r}}function u(n){return tt("form-element",n)}function E(n,r){n.setAttribute(r.type,r.value)}function C(n){function r(){var e;(e=document.getElementById(n))==null||e.remove()}let t=document.createElement("button");return t.textContent="X",t.addEventListener("click",r),t.classList.add("delete"),E(t,u("delete-"+n)),t}var x=class{};var p=class extends x{constructor(t,e,a){super();this.id=d(),this.topic=h(t),this.label=e,this.strategy=a}static getConsumerWrapper(t,e){let a=document.createElement("div");return a.id=t,a.classList.add("consumer-item"),e&&e.length>0&&a.setAttribute("data-label",e),a}getElement(){let t=p.getConsumerWrapper(this.id,this.getLabel());t.textContent=this.getLabel()+": ",t.appendChild(this.getDisplayElement());let e=document.createElement("p");return e.textContent=this.topic,t.appendChild(C(this.id)),t.appendChild(e),t}getDisplayElement(){return this.strategy.createConsumerElement(this.topic,{label:this.label,id:this.id,value:!1})}getLabel(){return this.label?this.label:"simple-consumer"}};var T=class{},L=(t=>(t.BOOLEAN_STRATEGY="BOOLEAN_STRATEGY",t.NUMBER_STRATEGY="NUMBER_STRATEGY",t))(L||{});var f=class extends T{constructor(){super(...arguments);this.strategyType="NUMBER_STRATEGY"}dispatchEvent(t,...e){let a=e[0],o=e[1],l=t.target,m=S(a,o,l==null?void 0:l.valueAsNumber),s=b.get(a);s==null||s.forEach(i=>{i.dispatchEvent(m)})}createProviderElement(t,e){let a=d(),o=document.createElement("form");o.classList.add("number-strategy-form"),o.id=a;let l=d(),m=A(l,e||t,"provider-item-label_"+t);o.appendChild(m);let s=M(l,"provider-item-input_"+t,"number");return s.setAttribute("name",e||t),s.setAttribute("min","0"),s.setAttribute("max","1"),s.setAttribute("step","0.1"),s.setAttribute("placeholder","% max. value"),s.addEventListener("change",i=>this.dispatchEvent(i,t,l)),o.appendChild(s),o.appendChild(C(a)),o}createConsumerElement(t,e){let a=document.createElement("span"),o=parseFloat(e.value);return isNaN(o)?a.textContent="N/A":a.textContent=o.toString(),a.addEventListener(t,this.update),y(t,a),a}update(t){let e=t.detail,a=this;a&&(a.textContent=e.value)}};function et(n,r){let t=document.createElement("div");if(r!=null)switch(r){case"BOOLEAN_STRATEGY".valueOf():t=new c().createProviderElement(n);break;case"NUMBER_STRATEGY".valueOf():t=new f().createProviderElement(n);break;default:console.error("Cannot create provider for non existent strategy: ",r);break}return t}function nt(n,r,t){let e=null;if(t!=null)switch(t){case"BOOLEAN_STRATEGY".valueOf():e=new p(n,r,new c);break;case"NUMBER_STRATEGY".valueOf():e=new p(n,r,new f);break;default:console.error("Cannot create provider for non existent strategy: ",t);break}return e}function H(n,r){var o,l,m;let t="",e="",a=null;if(n.forEach((s,i)=>{i===I?t=h(s.toString()):i===P?a=s:i===_&&(e=s)}),t&&t.length>0&&a)switch(r){case R.PROVIDER:(o=O())==null||o.appendChild(et(t,a));break;case R.CONSUMER:let s=(l=nt(t,e,a))==null?void 0:l.getElement();s&&((m=D())==null||m.appendChild(s));break;default:console.error("No device implementation exists for given type: ",r);break}}var R=(t=>(t.PROVIDER="PROVIDER",t.CONSUMER="CONSUMER",t))(R||{});var I="topic",_="name",P="strategies";function Y(n){let r=document.createElement("input");return E(r,u("submit_"+h(n))),r.setAttribute("type","submit"),r.setAttribute("value",n),r}function v(n){let r=document.createElement("option");return E(r,u("select-option_"+h(n))),r.setAttribute("value",n),r.textContent=n,r}function W(n){let r=d(),t=document.createElement("label");E(t,u("strategy-select-label")),t.setAttribute("for",r),t.textContent="Use Case";let e=document.createElement("select");E(e,u("strategy-select")),e.id=r,e.setAttribute("name",P),Object.keys(L).filter(a=>isNaN(Number(a))).forEach(a=>{e.appendChild(v(a))}),n.appendChild(document.createElement("br")),n.appendChild(t),n.appendChild(e)}function rt(n){let r=d(),t=document.createElement("label");E(t,u("consumer-topic-label")),t.setAttribute("for",r),t.textContent="Available Topics";let e=document.createElement("select");E(e,u("consumer-topic-select")),e.id=r,e.setAttribute("name",I),g.forEach(a=>{e.appendChild(v(a))}),n.appendChild(document.createElement("br")),n.appendChild(t),n.appendChild(e)}function K(n){let r=d(),t=document.createElement("span");return t.setAttribute("role","error"),t.id=r,t.style.display="none",t.style.color="red",t.textContent=n,t}function q(n){if(n){let r=j("Topic","provider-topic",I);n.appendChild(r[0]),n.appendChild(r[1]),W(n);let t=Y("Add Provider"),e=K("Invalid: Duplicate Topic");n.appendChild(t),n.appendChild(e),n.addEventListener("submit",a=>{a.preventDefault();let o=a.target,l=new FormData(o),m=!0,s="";if(l.forEach((i,N)=>{N===I&&(s=h(i.toString()),g.includes(s)?(e.style.display="",m=!1):(g.push(s),m=!0))}),m){let i=document.querySelector('#consumer-form > select[data-form-element="consumer-topic-select"]');i==null||i.appendChild(v(s)),e.style.display="none",o.reset(),H(l,"PROVIDER")}})}}function A(n,r,t){let e=document.createElement("label");return e.setAttribute("for",n),E(e,u((t||r)+"-label")),e.textContent=r,e}function M(n,r,t){let e=document.createElement("input");return e.id=n,E(e,u(r+"-input")),e.setAttribute("type",t),e}function j(n,r,t){let e=d(),a=A(e,n,r),o=M(e,r,"text");return o.setAttribute("name",t),o.setAttribute("placeholder",n),o.setAttribute("required","true"),[a,o]}function X(n){if(n){n.innerHTML="";let r=j("Name","consumer-name",_);n.appendChild(r[0]),n.appendChild(r[1]),rt(n),W(n);let t=Y("Add Consumer");n.appendChild(t);let e=K("Invalid: Name cannot be empty.");n.appendChild(e),n.addEventListener("submit",a=>{a.preventDefault();let o=a.target,l=new FormData(o),m=!0;l.forEach((s,i)=>{i===_&&(s.toString().trim().length===0?(e.style.display="",m=!1):m=!0)}),m&&(e.style.display="none",o.reset(),H(l,"CONSUMER"))})}}var F="bool-strategy-off",w="bool-strategy-on",c=class extends T{constructor(){super(...arguments);this.strategyType="BOOLEAN_STRATEGY"}static parseValue(t){return t.value>0||t.value<0||t.value==="true"||t.value===!0}static setValue(t,e){t?(e.textContent="ON",e.classList.contains(F)&&e.classList.remove(F),e.classList.add(w)):(e.textContent="OFF",e.classList.contains(w)&&e.classList.remove(w),e.classList.add(F))}dispatchEvent(t,...e){let a=e[0],o=e[1],l=t.target,m=S(a,o,l==null?void 0:l.checked),s=b.get(a);s==null||s.forEach(i=>{i.dispatchEvent(m)})}createProviderElement(t,e){let a=d(),o=document.createElement("form");o.id=a,o.classList.add("bool-strategy-form");let l=d(),m=A(l,e||t,"provider-item-label_"+t);o.appendChild(m);let s=M(l,"provider-item-input_"+t,"checkbox");return s.setAttribute("name",e||t),s.addEventListener("change",i=>this.dispatchEvent(i,t,l)),o.appendChild(s),o.appendChild(C(a)),o}createConsumerElement(t,e){let a=c.parseValue(e),o=document.createElement("span");return c.setValue(a,o),o.addEventListener(t,this.update),y(t,o),o}update(t){let e=t.detail,a=this;a&&c.setValue(c.parseValue(e),a)}};var z;(z=document.getElementById("load-demo-button"))==null||z.addEventListener("click",n=>{let r="light-1",t="light-2",e="heating-1";g.push(r),g.push(t),g.push(e);let a=document.querySelector('#consumer-form > select[data-form-element="consumer-topic-select"]');a==null||a.appendChild(v(r)),a==null||a.appendChild(v(t)),a==null||a.appendChild(v(e));let o=O(),l=new c().createProviderElement(r);o==null||o.appendChild(l);let m=new c().createProviderElement(t);o==null||o.appendChild(m);let s=new f().createProviderElement(e);o==null||o.appendChild(s);let i=D(),N=new p(r,"Kitchen - Light (Left)",new c);i==null||i.appendChild(N.getElement());let Q=new p(r,"Kitchen - Light (Right)",new c);i==null||i.appendChild(Q.getElement());let Z=new p(t,"Living Room - Light (All)",new c);i==null||i.appendChild(Z.getElement());let $=new p(e,"Living Room - (Heating)",new f);i==null||i.appendChild($.getElement());let B=n.target;B.disabled=!0,B.style.display="none"});var J;(J=document.getElementById("load-demo-button"))==null||J.click();q(document.getElementById(V));X(document.getElementById(G));})();
