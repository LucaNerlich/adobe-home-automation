"use strict";(()=>{var Y="provider",W="provider-form",X="consumer",K="consumer-form";function l(){let n=()=>Math.floor((1+Math.random())*65536).toString(16).substring(1);return n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()}function H(){return document.getElementById(X)}function N(){return document.getElementById(Y)}function I(n,o,e){return new CustomEvent(n,{detail:{id:o,value:e}})}function h(n){return n?.replaceAll(" ","-").toLowerCase()}function x(n,o){let e=document.createElement("form");return e.classList.add(`${o}-form`),e.id=n,e}function oe(n,o){return{type:"data-"+n,value:o}}function E(n){return oe("form-element",n)}function g(n,o){n.setAttribute(o.type,o.value)}function F(){return document.querySelector('#consumer-form > select[data-form-element="consumer-topic-select"]')}function T(n,o){function e(){document.getElementById(n)?.remove(),o&&o()}let t=document.createElement("button");return t.textContent="X",t.addEventListener("click",e),t.classList.add("delete"),g(t,E("delete-"+n)),t}var P=class{};var R=new Map,f=new Map,d=()=>{function n(s,m){m&&(R.has(s)?R.get(s)?.push(m):R.set(s,[m]))}function o(s){R.has(s)&&R.delete(s)}function e(s){return R.get(s)}function t(s,m){if(f.has(s)){let c=f.get(s);f.set(s,c?c+1:1)}else f.set(s,1),m&&m()}function r(s){if(f.has(s)){let c=f.get(s)??0,A=c>1?c-1:0;if(f.set(s,A),A===0){console.warn('Deleted last provider of topic: "%s".',s);let _=F();Array.from(_?.options).forEach(v=>{v.value===s&&v.remove()})}}return!1}function i(s){return f.get(s)??0}function a(){return f}return{addConsumer:n,removeConsumer:o,getConsumer:e,addTopic:t,removeTopic:r,getTopicCount:i,getAllTopics:a}};var p=class n extends P{constructor(e,t,r){super();this.registryService=d();this.id=l(),this.topic=h(e),this.label=t,this.strategy=r}static getConsumerWrapper(e,t){let r=document.createElement("div");return r.id=e,r.classList.add("consumer-item"),t&&t.length>0&&r.setAttribute("data-label",t),r}getElement(){let e=n.getConsumerWrapper(this.id,this.getLabel());e.classList.add(`consumer-item-${this.strategy.strategyType}`),e.textContent=this.getLabel()+": ",e.appendChild(this.getDisplayElement());let t=document.createElement("p");return t.textContent=this.topic,e.appendChild(T(this.id,()=>{this.registryService.removeConsumer(this.topic)})),e.appendChild(t),e}getDisplayElement(){return this.strategy.createConsumerElement(this.topic,{label:this.label,id:this.id,value:!1})}getLabel(){return this.label?this.label:"simple-consumer"}};var C=class{};var L=(t=>(t.BOOLEAN_STRATEGY="BOOLEAN_STRATEGY",t.NUMBER_STRATEGY="NUMBER_STRATEGY",t.TEXT_STRATEGY="TEXT_STRATEGY",t))(L||{});var b=class extends C{constructor(){super(...arguments);this.strategyType="NUMBER_STRATEGY";this.registryService=d()}dispatchEvent(e,...t){let r=t[0],i=t[1],a=e.target,s=I(r,i,a?.valueAsNumber);this.registryService.getConsumer(r)?.forEach(c=>{c.dispatchEvent(s)})}createProviderElement(e,t){let r=l(),i=x(r,"number-strategy"),a=l(),s=M(a,t||e,"provider-item-label_"+e);i.appendChild(s);let m=D(a,"provider-item-input_"+e,"number");return m.setAttribute("name",t||e),m.setAttribute("min","0"),m.setAttribute("max","1"),m.setAttribute("step","0.1"),m.setAttribute("placeholder","% max. value"),m.addEventListener("change",c=>this.dispatchEvent(c,e,a)),i.appendChild(m),i.appendChild(T(r,()=>{this.registryService.removeTopic(e)})),i}createConsumerElement(e,t){let r=document.createElement("span"),i=parseFloat(t.value);return isNaN(i)?r.textContent="N/A":r.textContent=i.toString(),r.addEventListener(e,this.update),this.registryService.addConsumer(e,r),r}update(e){let t=e.detail,r=this;r&&(r.textContent=t.value)}};var y=class extends C{constructor(){super(...arguments);this.strategyType="TEXT_STRATEGY";this.registryService=d()}createConsumerElement(e,t){let r=document.createElement("span");return r.textContent=t.value,r.style.color="blue",r.addEventListener(e,this.update),this.registryService.addConsumer(e,r),r}createProviderElement(e,t){let r=l(),i=x(r,"text-strategy"),a=l(),s=M(a,t||e,"provider-item-label_"+e);i.appendChild(s);let m=D(a,"provider-item-input_"+e,"text");return m.setAttribute("name",t||e),m.setAttribute("placeholder","some led display"),m.addEventListener("input",c=>this.dispatchEvent(c,e,a)),i.appendChild(m),i.appendChild(T(r,()=>{this.registryService.removeTopic(e)})),i}dispatchEvent(e,...t){let r=t[0],i=t[1],a=e.target,s=I(r,i,a?.value);this.registryService.getConsumer(r)?.forEach(c=>{c.dispatchEvent(s)})}update(e){let t=e.detail,r=this;r&&(r.textContent=t.value)}};function se(n,o){let e=document.createElement("div");if(o!=null)switch(o){case"BOOLEAN_STRATEGY":e=new u().createProviderElement(n);break;case"NUMBER_STRATEGY":e=new b().createProviderElement(n);break;case"TEXT_STRATEGY":e=new y().createProviderElement(n);break;default:console.error("Cannot create provider for non existent strategy: ",o);break}return e}function ae(n,o,e){let t=null;if(e!=null)switch(e){case"BOOLEAN_STRATEGY":t=new p(n,o,new u);break;case"NUMBER_STRATEGY":t=new p(n,o,new b);break;case"TEXT_STRATEGY":t=new p(n,o,new y);break;default:console.error("Cannot create consumer for non existent strategy: ",e);break}return t}function B(n,o){let e="",t="",r=null;if(n.forEach((i,a)=>{a===O?e=h(i.toString()):a===k?r=i:a===w&&(t=i)}),e&&e.length>0&&r){let i=ae(e,t,r)?.getElement();switch(o){case"PROVIDER":N()?.appendChild(se(e,r));break;case"CONSUMER":i&&H()?.appendChild(i);break;default:console.error("No device implementation exists for given type: ",o);break}}}var O="topic",w="name",k="strategies";function j(n){let o=document.createElement("input");return g(o,E("submit_"+h(n))),o.setAttribute("type","submit"),o.setAttribute("value",n),o}function S(n){let o=document.createElement("option");return g(o,E("select-option_"+h(n))),o.setAttribute("value",n),o.textContent=n.replace("_STRATEGY",""),o}function q(n){n.appendChild(document.createElement("br"));let o=l(),e=document.createElement("label");g(e,E("strategy-select-label")),e.setAttribute("for",o),e.textContent="Use Case",n.appendChild(e);let t=document.createElement("select");g(t,E("strategy-select")),t.id=o,t.setAttribute("name",k),Object.keys(L).filter(r=>isNaN(Number(r))).forEach(r=>{t.appendChild(S(r))}),n.appendChild(t)}function me(n){let o=d();n.appendChild(document.createElement("br"));let e=l(),t=document.createElement("label");g(t,E("consumer-topic-label")),t.setAttribute("for",e),t.textContent="Available Topics",n.appendChild(t);let r=document.createElement("select");g(r,E("consumer-topic-select")),r.id=e,r.setAttribute("name",O),o.getAllTopics().forEach((i,a)=>{r.appendChild(S(a))}),n.appendChild(r)}function $(n){let o=l(),e=document.createElement("span");return e.setAttribute("role","error"),e.id=o,e.style.display="none",e.style.color="red",e.textContent=n,e}function z(n){let o=d();if(n){let e=J("Topic","provider-topic",O);n.appendChild(e[0]),n.appendChild(e[1]),q(n);let t=j("Add Provider"),r=$("Invalid: Duplicate Topic");n.appendChild(t),n.appendChild(r),n.addEventListener("submit",i=>{i.preventDefault();let a=i.target,s=new FormData(a),m=!0,c="";s.forEach((A,_)=>{_===O&&(c=h(A.toString()),o.addTopic(c,()=>{F()?.appendChild(S(c))}),m=!0)}),m&&(r.style.display="none",a.reset(),B(s,"PROVIDER"))})}}function M(n,o,e){let t=document.createElement("label");return t.setAttribute("for",n),g(t,E((e||o)+"-label")),t.textContent=o,t}function D(n,o,e){let t=document.createElement("input");return t.id=n,g(t,E(o+"-input")),t.setAttribute("type",e),t}function J(n,o,e){let t=l(),r=M(t,n,o),i=D(t,o,"text");return i.setAttribute("name",e),i.setAttribute("placeholder",n),i.setAttribute("required","true"),[r,i]}function Q(n){if(n){n.innerHTML="";let o=J("Name","consumer-name",w);n.appendChild(o[0]),n.appendChild(o[1]),me(n),q(n);let e=j("Add Consumer");n.appendChild(e);let t=$("Invalid: Name cannot be empty.");n.appendChild(t),n.addEventListener("submit",r=>{r.preventDefault();let i=r.target,a=new FormData(i),s=!0;a.forEach((m,c)=>{c===w&&(m.toString().trim().length===0?(t.style.display="",s=!1):s=!0)}),s&&(t.style.display="none",i.reset(),B(a,"CONSUMER"))})}}var G="bool-strategy-off",V="bool-strategy-on",u=class n extends C{constructor(){super(...arguments);this.strategyType="BOOLEAN_STRATEGY";this.registryService=d()}static parseValue(e){return e.value>0||e.value<0||e.value==="true"||e.value===!0}static setValue(e,t){e?(t.textContent="ON",t.classList.contains(G)&&t.classList.remove(G),t.classList.add(V)):(t.textContent="OFF",t.classList.contains(V)&&t.classList.remove(V),t.classList.add(G))}dispatchEvent(e,...t){let r=t[0],i=t[1],a=e.target,s=I(r,i,a?.checked);this.registryService.getConsumer(r)?.forEach(c=>{c.dispatchEvent(s)})}createProviderElement(e,t){let r=l(),i=x(r,"bool-strategy"),a=l(),s=M(a,t||e,"provider-item-label_"+e);i.appendChild(s);let m=D(a,"provider-item-input_"+e,"checkbox");return m.setAttribute("name",t||e),m.addEventListener("change",c=>this.dispatchEvent(c,e,a)),i.appendChild(m),i.appendChild(T(r,()=>{this.registryService.removeTopic(e)})),i}createConsumerElement(e,t){let r=n.parseValue(t),i=document.createElement("span");return n.setValue(r,i),i.addEventListener(e,this.update),this.registryService.addConsumer(e,i),i}update(e){let t=e.detail,r=this;r&&n.setValue(n.parseValue(t),r)}};document.getElementById("load-demo-button")?.addEventListener("click",n=>{let o="light-1",e="light-2",t="heating-1",r="text-1",i=d(),a=document.querySelector('#consumer-form > select[data-form-element="consumer-topic-select"]');a?.appendChild(S(o)),a?.appendChild(S(e)),a?.appendChild(S(t)),a?.appendChild(S(r));let s=N(),m=new u().createProviderElement(o);s?.appendChild(m),i.addTopic(o);let c=new u().createProviderElement(e);s?.appendChild(c),i.addTopic(e);let A=new b().createProviderElement(t);s?.appendChild(A),i.addTopic(t);let _=new y().createProviderElement(r);s?.appendChild(_),i.addTopic(r);let v=H(),Z=new p(o,"Kitchen - Light (Left)",new u);v?.appendChild(Z.getElement());let ee=new p(o,"Kitchen - Light (Right)",new u);v?.appendChild(ee.getElement());let te=new p(e,"Living Room - Light (All)",new u);v?.appendChild(te.getElement());let ne=new p(t,"Living Room - (Heating)",new b);v?.appendChild(ne.getElement());let re=new p(r,"LED Display - (Wall)",new y);v?.appendChild(re.getElement());let U=n.target;U.disabled=!0,U.style.display="none"});document.getElementById("load-demo-button")?.click();z(document.getElementById(W));Q(document.getElementById(K));})();
