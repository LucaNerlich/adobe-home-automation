(()=>{var V="provider",Y="provider-form",W="consumer",X="consumer-form";function c(){let n=()=>Math.floor((1+Math.random())*65536).toString(16).substring(1);return n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()}function _(){return document.getElementById(W)}function R(){return document.getElementById(V)}function I(n,a,t){return new CustomEvent(n,{detail:{id:a,value:t}})}function f(n){return n==null?void 0:n.replaceAll(" ","-").toLowerCase()}function S(n,a){let t=document.createElement("form");return t.classList.add(`${a}-form`),t.id=n,t}function st(n,a){return{type:"data-"+n,value:a}}function E(n){return st("form-element",n)}function g(n,a){n.setAttribute(a.type,a.value)}function v(n){function a(){var e;(e=document.getElementById(n))==null||e.remove()}let t=document.createElement("button");return t.textContent="X",t.addEventListener("click",a),t.classList.add("delete"),g(t,E("delete-"+n)),t}var N=class{};var u=class extends N{constructor(t,e,r){super();this.id=c(),this.topic=f(t),this.label=e,this.strategy=r}static getConsumerWrapper(t,e){let r=document.createElement("div");return r.id=t,r.classList.add("consumer-item"),e&&e.length>0&&r.setAttribute("data-label",e),r}getElement(){let t=u.getConsumerWrapper(this.id,this.getLabel());t.classList.add(`consumer-item-${this.strategy.strategyType}`),t.textContent=this.getLabel()+": ",t.appendChild(this.getDisplayElement());let e=document.createElement("p");return e.textContent=this.topic,t.appendChild(v(this.id)),t.appendChild(e),t}getDisplayElement(){return this.strategy.createConsumerElement(this.topic,{label:this.label,id:this.id,value:!1})}getLabel(){return this.label?this.label:"simple-consumer"}};var C=class{},A=(e=>(e.BOOLEAN_STRATEGY="BOOLEAN_STRATEGY",e.NUMBER_STRATEGY="NUMBER_STRATEGY",e.TEXT_STRATEGY="TEXT_STRATEGY",e))(A||{});var h=new Map;function x(n,a){var t;a&&(h.has(n)?(t=h.get(n))==null||t.push(a):h.set(n,[a]))}var T=[];var b=class extends C{constructor(){super(...arguments);this.strategyType="NUMBER_STRATEGY"}dispatchEvent(t,...e){let r=e[0],s=e[1],o=t.target,m=I(r,s,o==null?void 0:o.valueAsNumber),i=h.get(r);i==null||i.forEach(l=>{l.dispatchEvent(m)})}createProviderElement(t,e){let r=c(),s=S(r,"number-strategy"),o=c(),m=M(o,e||t,"provider-item-label_"+t);s.appendChild(m);let i=D(o,"provider-item-input_"+t,"number");return i.setAttribute("name",e||t),i.setAttribute("min","0"),i.setAttribute("max","1"),i.setAttribute("step","0.1"),i.setAttribute("placeholder","% max. value"),i.addEventListener("change",l=>this.dispatchEvent(l,t,o)),s.appendChild(i),s.appendChild(v(r)),s}createConsumerElement(t,e){let r=document.createElement("span"),s=parseFloat(e.value);return isNaN(s)?r.textContent="N/A":r.textContent=s.toString(),r.addEventListener(t,this.update),x(t,r),r}update(t){let e=t.detail,r=this;r&&(r.textContent=e.value)}};var L=class extends C{constructor(){super(...arguments);this.strategyType="TEXT_STRATEGY"}createConsumerElement(t,e){let r=document.createElement("span");return r.textContent=e.value,r.style.color="blue",r.addEventListener(t,this.update),x(t,r),r}createProviderElement(t,e){let r=c(),s=S(r,"text-strategy"),o=c(),m=M(o,e||t,"provider-item-label_"+t);s.appendChild(m);let i=D(o,"provider-item-input_"+t,"text");return i.setAttribute("name",e||t),i.setAttribute("placeholder","some led display"),i.addEventListener("input",l=>this.dispatchEvent(l,t,o)),s.appendChild(i),s.appendChild(v(r)),s}dispatchEvent(t,...e){let r=e[0],s=e[1],o=t.target,m=I(r,s,o==null?void 0:o.value),i=h.get(r);i==null||i.forEach(l=>{l.dispatchEvent(m)})}update(t){let e=t.detail,r=this;r&&(r.textContent=e.value)}};function ot(n,a){let t=document.createElement("div");if(a!=null)switch(a){case"BOOLEAN_STRATEGY":t=new p().createProviderElement(n);break;case"NUMBER_STRATEGY":t=new b().createProviderElement(n);break;case"TEXT_STRATEGY":t=new L().createProviderElement(n);break;default:console.error("Cannot create provider for non existent strategy: ",a);break}return t}function it(n,a,t){let e=null;if(t!=null)switch(t){case"BOOLEAN_STRATEGY":e=new u(n,a,new p);break;case"NUMBER_STRATEGY":e=new u(n,a,new b);break;case"TEXT_STRATEGY":e=new u(n,a,new L);break;default:console.error("Cannot create consumer for non existent strategy: ",t);break}return e}function w(n,a){var s,o,m;let t="",e="",r=null;if(n.forEach((i,l)=>{l===O?t=f(i.toString()):l===B?r=i:l===P&&(e=i)}),t&&t.length>0&&r){let i=(s=it(t,e,r))==null?void 0:s.getElement();switch(a){case H.PROVIDER:(o=R())==null||o.appendChild(ot(t,r));break;case H.CONSUMER:i&&((m=_())==null||m.appendChild(i));break;default:console.error("No device implementation exists for given type: ",a);break}}}var H=(t=>(t.PROVIDER="PROVIDER",t.CONSUMER="CONSUMER",t))(H||{});var O="topic",P="name",B="strategies";function K(n){let a=document.createElement("input");return g(a,E("submit_"+f(n))),a.setAttribute("type","submit"),a.setAttribute("value",n),a}function y(n){let a=document.createElement("option");return g(a,E("select-option_"+f(n))),a.setAttribute("value",n),a.textContent=n,a}function q(n){n.appendChild(document.createElement("br"));let a=c(),t=document.createElement("label");g(t,E("strategy-select-label")),t.setAttribute("for",a),t.textContent="Use Case",n.appendChild(t);let e=document.createElement("select");g(e,E("strategy-select")),e.id=a,e.setAttribute("name",B),Object.keys(A).filter(r=>isNaN(Number(r))).forEach(r=>{e.appendChild(y(r))}),n.appendChild(e)}function lt(n){n.appendChild(document.createElement("br"));let a=c(),t=document.createElement("label");g(t,E("consumer-topic-label")),t.setAttribute("for",a),t.textContent="Available Topics",n.appendChild(t);let e=document.createElement("select");g(e,E("consumer-topic-select")),e.id=a,e.setAttribute("name",O),T.forEach(r=>{e.appendChild(y(r))}),n.appendChild(e)}function $(n){let a=c(),t=document.createElement("span");return t.setAttribute("role","error"),t.id=a,t.style.display="none",t.style.color="red",t.textContent=n,t}function j(n){if(n){let a=z("Topic","provider-topic",O);n.appendChild(a[0]),n.appendChild(a[1]),q(n);let t=K("Add Provider"),e=$("Invalid: Duplicate Topic");n.appendChild(t),n.appendChild(e),n.addEventListener("submit",r=>{r.preventDefault();let s=r.target,o=new FormData(s),m=!0,i="";if(o.forEach((l,F)=>{F===O&&(i=f(l.toString()),T.includes(i)?(e.style.display="",m=!1):(T.push(i),m=!0))}),m){let l=document.querySelector('#consumer-form > select[data-form-element="consumer-topic-select"]');l==null||l.appendChild(y(i)),e.style.display="none",s.reset(),w(o,"PROVIDER")}})}}function M(n,a,t){let e=document.createElement("label");return e.setAttribute("for",n),g(e,E((t||a)+"-label")),e.textContent=a,e}function D(n,a,t){let e=document.createElement("input");return e.id=n,g(e,E(a+"-input")),e.setAttribute("type",t),e}function z(n,a,t){let e=c(),r=M(e,n,a),s=D(e,a,"text");return s.setAttribute("name",t),s.setAttribute("placeholder",n),s.setAttribute("required","true"),[r,s]}function J(n){if(n){n.innerHTML="";let a=z("Name","consumer-name",P);n.appendChild(a[0]),n.appendChild(a[1]),lt(n),q(n);let t=K("Add Consumer");n.appendChild(t);let e=$("Invalid: Name cannot be empty.");n.appendChild(e),n.addEventListener("submit",r=>{r.preventDefault();let s=r.target,o=new FormData(s),m=!0;o.forEach((i,l)=>{l===P&&(i.toString().trim().length===0?(e.style.display="",m=!1):m=!0)}),m&&(e.style.display="none",s.reset(),w(o,"CONSUMER"))})}}var G="bool-strategy-off",k="bool-strategy-on",p=class extends C{constructor(){super(...arguments);this.strategyType="BOOLEAN_STRATEGY"}static parseValue(t){return t.value>0||t.value<0||t.value==="true"||t.value===!0}static setValue(t,e){t?(e.textContent="ON",e.classList.contains(G)&&e.classList.remove(G),e.classList.add(k)):(e.textContent="OFF",e.classList.contains(k)&&e.classList.remove(k),e.classList.add(G))}dispatchEvent(t,...e){let r=e[0],s=e[1],o=t.target,m=I(r,s,o==null?void 0:o.checked),i=h.get(r);i==null||i.forEach(l=>{l.dispatchEvent(m)})}createProviderElement(t,e){let r=c(),s=S(r,"bool-strategy"),o=c(),m=M(o,e||t,"provider-item-label_"+t);s.appendChild(m);let i=D(o,"provider-item-input_"+t,"checkbox");return i.setAttribute("name",e||t),i.addEventListener("change",l=>this.dispatchEvent(l,t,o)),s.appendChild(i),s.appendChild(v(r)),s}createConsumerElement(t,e){let r=p.parseValue(e),s=document.createElement("span");return p.setValue(r,s),s.addEventListener(t,this.update),x(t,s),s}update(t){let e=t.detail,r=this;r&&p.setValue(p.parseValue(e),r)}};var Q;(Q=document.getElementById("load-demo-button"))==null||Q.addEventListener("click",n=>{let a="light-1",t="light-2",e="heating-1",r="text-1";T.push(a),T.push(t),T.push(e),T.push(r);let s=document.querySelector('#consumer-form > select[data-form-element="consumer-topic-select"]');s==null||s.appendChild(y(a)),s==null||s.appendChild(y(t)),s==null||s.appendChild(y(e)),s==null||s.appendChild(y(r));let o=R(),m=new p().createProviderElement(a);o==null||o.appendChild(m);let i=new p().createProviderElement(t);o==null||o.appendChild(i);let l=new b().createProviderElement(e);o==null||o.appendChild(l);let F=new L().createProviderElement(r);o==null||o.appendChild(F);let d=_(),tt=new u(a,"Kitchen - Light (Left)",new p);d==null||d.appendChild(tt.getElement());let et=new u(a,"Kitchen - Light (Right)",new p);d==null||d.appendChild(et.getElement());let nt=new u(t,"Living Room - Light (All)",new p);d==null||d.appendChild(nt.getElement());let rt=new u(e,"Living Room - (Heating)",new b);d==null||d.appendChild(rt.getElement());let at=new u(r,"LED Display - (Wall)",new L);d==null||d.appendChild(at.getElement());let U=n.target;U.disabled=!0,U.style.display="none"});var Z;(Z=document.getElementById("load-demo-button"))==null||Z.click();j(document.getElementById(Y));J(document.getElementById(X));})();
