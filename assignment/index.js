(()=>{var g=new Map;function y(n,a){var t;a&&(g.has(n)?(t=g.get(n))==null||t.push(a):g.set(n,[a]))}var h=[],U="provider",V="provider-form",Y="consumer",W="consumer-form";function c(){let n=()=>Math.floor((1+Math.random())*65536).toString(16).substring(1);return n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()}function O(){return document.getElementById(Y)}function _(){return document.getElementById(U)}function D(n,a,t){return new CustomEvent(n,{detail:{id:a,value:t}})}function v(n){return n==null?void 0:n.replaceAll(" ","-").toLowerCase()}function I(n,a){let t=document.createElement("form");return t.classList.add(`${a}-form`),t.id=n,t}function nt(n,a){return{type:"data-"+n,value:a}}function u(n){return nt("form-element",n)}function E(n,a){n.setAttribute(a.type,a.value)}function T(n){function a(){var e;(e=document.getElementById(n))==null||e.remove()}let t=document.createElement("button");return t.textContent="X",t.addEventListener("click",a),t.classList.add("delete"),E(t,u("delete-"+n)),t}var R=class{};var d=class extends R{constructor(t,e,r){super();this.id=c(),this.topic=v(t),this.label=e,this.strategy=r}static getConsumerWrapper(t,e){let r=document.createElement("div");return r.id=t,r.classList.add("consumer-item"),e&&e.length>0&&r.setAttribute("data-label",e),r}getElement(){let t=d.getConsumerWrapper(this.id,this.getLabel());t.textContent=this.getLabel()+": ",t.appendChild(this.getDisplayElement());let e=document.createElement("p");return e.textContent=this.topic,t.appendChild(T(this.id)),t.appendChild(e),t}getDisplayElement(){return this.strategy.createConsumerElement(this.topic,{label:this.label,id:this.id,value:!1})}getLabel(){return this.label?this.label:"simple-consumer"}};var f=class{},b=(e=>(e.BOOLEAN_STRATEGY="BOOLEAN_STRATEGY",e.NUMBER_STRATEGY="NUMBER_STRATEGY",e.TEXT_STRATEGY="TEXT_STRATEGY",e))(b||{});var C=class extends f{constructor(){super(...arguments);this.strategyType="NUMBER_STRATEGY"}dispatchEvent(t,...e){let r=e[0],o=e[1],l=t.target,m=D(r,o,l==null?void 0:l.valueAsNumber),s=g.get(r);s==null||s.forEach(i=>{i.dispatchEvent(m)})}createProviderElement(t,e){let r=c(),o=I(r,"number-strategy"),l=c(),m=L(l,e||t,"provider-item-label_"+t);o.appendChild(m);let s=A(l,"provider-item-input_"+t,"number");return s.setAttribute("name",e||t),s.setAttribute("min","0"),s.setAttribute("max","1"),s.setAttribute("step","0.1"),s.setAttribute("placeholder","% max. value"),s.addEventListener("change",i=>this.dispatchEvent(i,t,l)),o.appendChild(s),o.appendChild(T(r)),o}createConsumerElement(t,e){let r=document.createElement("span"),o=parseFloat(e.value);return isNaN(o)?r.textContent="N/A":r.textContent=o.toString(),r.addEventListener(t,this.update),y(t,r),r}update(t){let e=t.detail,r=this;r&&(r.textContent=e.value)}};var S=class extends f{constructor(){super(...arguments);this.strategyType="TEXT_STRATEGY"}createConsumerElement(t,e){let r=document.createElement("span");return r.textContent=e.value,r.addEventListener(t,this.update),y(t,r),r}createProviderElement(t,e){let r=c(),o=I(r,"text-strategy"),l=c(),m=L(l,e||t,"provider-item-label_"+t);o.appendChild(m);let s=A(l,"provider-item-input_"+t,"text");return s.setAttribute("name",e||t),s.setAttribute("placeholder","some led display"),s.addEventListener("input",i=>this.dispatchEvent(i,t,l)),o.appendChild(s),o.appendChild(T(r)),o}dispatchEvent(t,...e){let r=e[0],o=e[1],l=t.target,m=D(r,o,l==null?void 0:l.value),s=g.get(r);s==null||s.forEach(i=>{i.dispatchEvent(m)})}update(t){let e=t.detail,r=this;r&&(r.textContent=e.value)}};function rt(n,a){let t=document.createElement("div");if(a!=null)switch(a){case"BOOLEAN_STRATEGY":t=new p().createProviderElement(n);break;case"NUMBER_STRATEGY":t=new C().createProviderElement(n);break;case"TEXT_STRATEGY":t=new S().createProviderElement(n);break;default:console.error("Cannot create provider for non existent strategy: ",a);break}return t}function at(n,a,t){let e=null;if(t!=null)switch(t){case"BOOLEAN_STRATEGY":e=new d(n,a,new p);break;case"NUMBER_STRATEGY":e=new d(n,a,new C);break;case"TEXT_STRATEGY":e=new d(n,a,new S);break;default:console.error("Cannot create consumer for non existent strategy: ",t);break}return e}function F(n,a){var o,l,m;let t="",e="",r=null;if(console.log("formData",n),n.forEach((s,i)=>{i===x?(t=v(s.toString()),console.log("topic",t)):i===w?(r=s,console.log("strategyType",r)):i===H&&(e=s)}),t&&t.length>0&&r){let s=(o=at(t,e,r))==null?void 0:o.getElement();switch(a){case N.PROVIDER:(l=_())==null||l.appendChild(rt(t,r));break;case N.CONSUMER:s&&((m=O())==null||m.appendChild(s));break;default:console.error("No device implementation exists for given type: ",a);break}}}var N=(t=>(t.PROVIDER="PROVIDER",t.CONSUMER="CONSUMER",t))(N||{});var x="topic",H="name",w="strategies";function X(n){let a=document.createElement("input");return E(a,u("submit_"+v(n))),a.setAttribute("type","submit"),a.setAttribute("value",n),a}function M(n){let a=document.createElement("option");return E(a,u("select-option_"+v(n))),a.setAttribute("value",n),a.textContent=n,a}function K(n){n.appendChild(document.createElement("br"));let a=c(),t=document.createElement("label");E(t,u("strategy-select-label")),t.setAttribute("for",a),t.textContent="Use Case",n.appendChild(t);let e=document.createElement("select");E(e,u("strategy-select")),e.id=a,e.setAttribute("name",w),Object.keys(b).filter(r=>isNaN(Number(r))).forEach(r=>{e.appendChild(M(r))}),n.appendChild(e)}function ot(n){n.appendChild(document.createElement("br"));let a=c(),t=document.createElement("label");E(t,u("consumer-topic-label")),t.setAttribute("for",a),t.textContent="Available Topics",n.appendChild(t);let e=document.createElement("select");E(e,u("consumer-topic-select")),e.id=a,e.setAttribute("name",x),h.forEach(r=>{e.appendChild(M(r))}),n.appendChild(e)}function q(n){let a=c(),t=document.createElement("span");return t.setAttribute("role","error"),t.id=a,t.style.display="none",t.style.color="red",t.textContent=n,t}function j(n){if(n){let a=$("Topic","provider-topic",x);n.appendChild(a[0]),n.appendChild(a[1]),K(n);let t=X("Add Provider"),e=q("Invalid: Duplicate Topic");n.appendChild(t),n.appendChild(e),n.addEventListener("submit",r=>{r.preventDefault();let o=r.target,l=new FormData(o),m=!0,s="";if(l.forEach((i,P)=>{P===x&&(s=v(i.toString()),h.includes(s)?(e.style.display="",m=!1):(h.push(s),m=!0))}),m){let i=document.querySelector('#consumer-form > select[data-form-element="consumer-topic-select"]');i==null||i.appendChild(M(s)),e.style.display="none",o.reset(),F(l,"PROVIDER")}})}}function L(n,a,t){let e=document.createElement("label");return e.setAttribute("for",n),E(e,u((t||a)+"-label")),e.textContent=a,e}function A(n,a,t){let e=document.createElement("input");return e.id=n,E(e,u(a+"-input")),e.setAttribute("type",t),e}function $(n,a,t){let e=c(),r=L(e,n,a),o=A(e,a,"text");return o.setAttribute("name",t),o.setAttribute("placeholder",n),o.setAttribute("required","true"),[r,o]}function z(n){if(n){n.innerHTML="";let a=$("Name","consumer-name",H);n.appendChild(a[0]),n.appendChild(a[1]),ot(n),K(n);let t=X("Add Consumer");n.appendChild(t);let e=q("Invalid: Name cannot be empty.");n.appendChild(e),n.addEventListener("submit",r=>{r.preventDefault();let o=r.target,l=new FormData(o),m=!0;l.forEach((s,i)=>{i===H&&(s.toString().trim().length===0?(e.style.display="",m=!1):m=!0)}),m&&(e.style.display="none",o.reset(),F(l,"CONSUMER"))})}}var B="bool-strategy-off",G="bool-strategy-on",p=class extends f{constructor(){super(...arguments);this.strategyType="BOOLEAN_STRATEGY"}static parseValue(t){return t.value>0||t.value<0||t.value==="true"||t.value===!0}static setValue(t,e){t?(e.textContent="ON",e.classList.contains(B)&&e.classList.remove(B),e.classList.add(G)):(e.textContent="OFF",e.classList.contains(G)&&e.classList.remove(G),e.classList.add(B))}dispatchEvent(t,...e){let r=e[0],o=e[1],l=t.target,m=D(r,o,l==null?void 0:l.checked),s=g.get(r);s==null||s.forEach(i=>{i.dispatchEvent(m)})}createProviderElement(t,e){let r=c(),o=I(r,"bool-strategy"),l=c(),m=L(l,e||t,"provider-item-label_"+t);o.appendChild(m);let s=A(l,"provider-item-input_"+t,"checkbox");return s.setAttribute("name",e||t),s.addEventListener("change",i=>this.dispatchEvent(i,t,l)),o.appendChild(s),o.appendChild(T(r)),o}createConsumerElement(t,e){let r=p.parseValue(e),o=document.createElement("span");return p.setValue(r,o),o.addEventListener(t,this.update),y(t,o),o}update(t){let e=t.detail,r=this;r&&p.setValue(p.parseValue(e),r)}};var J;(J=document.getElementById("load-demo-button"))==null||J.addEventListener("click",n=>{let a="light-1",t="light-2",e="heating-1";h.push(a),h.push(t),h.push(e);let r=document.querySelector('#consumer-form > select[data-form-element="consumer-topic-select"]');r==null||r.appendChild(M(a)),r==null||r.appendChild(M(t)),r==null||r.appendChild(M(e));let o=_(),l=new p().createProviderElement(a);o==null||o.appendChild(l);let m=new p().createProviderElement(t);o==null||o.appendChild(m);let s=new C().createProviderElement(e);o==null||o.appendChild(s);let i=O(),P=new d(a,"Kitchen - Light (Left)",new p);i==null||i.appendChild(P.getElement());let Z=new d(a,"Kitchen - Light (Right)",new p);i==null||i.appendChild(Z.getElement());let tt=new d(t,"Living Room - Light (All)",new p);i==null||i.appendChild(tt.getElement());let et=new d(e,"Living Room - (Heating)",new C);i==null||i.appendChild(et.getElement());let k=n.target;k.disabled=!0,k.style.display="none"});var Q;(Q=document.getElementById("load-demo-button"))==null||Q.click();j(document.getElementById(V));z(document.getElementById(W));})();
